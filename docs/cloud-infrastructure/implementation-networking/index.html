<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Procedure #   Register NSX Manager Instance with VMware Cloud Director  Register NSX Manager Instance with VMware Cloud Director #  VMware NSX can provide network resources to VMware Cloud Director (VCD) by registering the NSX Manager in VCD Infrastructure Resource.
Prerequisites #   Verify the VMware Cloud Director system requirements and supported versions of VMware NSX, VMware Product Interoperability Matrixes   Procedure #   From the top navigation bar, under Resources, click Infrastructure Resources.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Cloud Infrastructure Networking and Security Implementation">
<meta property="og:description" content="Procedure #   Register NSX Manager Instance with VMware Cloud Director  Register NSX Manager Instance with VMware Cloud Director #  VMware NSX can provide network resources to VMware Cloud Director (VCD) by registering the NSX Manager in VCD Infrastructure Resource.
Prerequisites #   Verify the VMware Cloud Director system requirements and supported versions of VMware NSX, VMware Product Interoperability Matrixes   Procedure #   From the top navigation bar, under Resources, click Infrastructure Resources.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://vcpat.cloudhappens.io/docs/cloud-infrastructure/implementation-networking/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2023-11-01T08:36:48+02:00">
<title>Cloud Infrastructure Networking and Security Implementation | VMware Cloud Provider Architecture Toolkit</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.dafac9ef405a9a51632c18a2edb71f7d98ac9be2fbbd65d96981e00d440210f4.js integrity="sha256-2vrJ70BamlFjLBii7bcffZism+L7vWXZaYHgDUQCEPQ=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>VMware Cloud Provider Architecture Toolkit</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li><a href=/feedback/><em>Feedback</em></a></li>
</ul>
<h2 id=draft-validated-solutions>
Draft Validated Solutions:
<a class=anchor href=#draft-validated-solutions>#</a>
</h2>
<ul>
<li><a href=/docs/cloud-infrastructure/><strong>Cloud Infrastructure</strong></a>
<ul>
<li><a href=/docs/cloud-infrastructure/planning/>Planning and Preparation</a></li>
<li><a href=/docs/cloud-infrastructure/design/>Design Objectives</a></li>
<li><a href=/docs/cloud-infrastructure/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/cloud-infrastructure/implementation/>Implementation</a></li>
<li><a href=/docs/cloud-infrastructure/operations/>Operational Guidance</a></li>
<li><a href=/docs/cloud-infrastructure/design-decisions/>Design Decisions</a></li>
<li><a href=/docs/cloud-infrastructure/solution-interop/>Solution Interoperability</a></li>
<li><a href=/docs/cloud-infrastructure/appendix/>Appendix</a></li>
</ul>
</li>
<li><a href=/docs/dr-migration/><strong>DR and Migration</strong></a>
<ul>
<li><a href=/docs/dr-migration/planning/>Planning and Preparation</a></li>
<li><a href=/docs/dr-migration/design/>Design Objectives</a></li>
<li><a href=/docs/dr-migration/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/dr-migration/implementation/>Implementation</a></li>
<li><a href=/docs/dr-migration/operations/>Operational Guidance</a></li>
</ul>
</li>
<li><a href=/docs/developer-ready-cloud/><strong>Developer Ready Cloud</strong></a>
<ul>
<li><a href=/docs/developer-ready-cloud/planning/>Planning and Preparation</a></li>
<li><a href=/docs/developer-ready-cloud/design/>Design Objectives</a></li>
<li><a href=/docs/developer-ready-cloud/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/developer-ready-cloud/implementation/>Implementation</a></li>
<li><a href=/docs/developer-ready-cloud/operations/>Operational Guidance</a></li>
</ul>
</li>
<li><a href=/docs/sovereign-cloud/><strong>Sovereign Cloud</strong></a>
<ul>
<li><a href=/docs/sovereign-cloud/planning/>Planning and Preparation</a></li>
<li><a href=/docs/sovereign-cloud/design/>Design Objectives</a></li>
<li><a href=/docs/sovereign-cloud/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/sovereign-cloud/implementation/>Implementation</a></li>
<li><a href=/docs/sovereign-cloud/operations/>Operational Guidance</a></li>
</ul>
</li>
</ul>
<h2 id=toolkit-documents>
Toolkit Documents:
<a class=anchor href=#toolkit-documents>#</a>
</h2>
<ul>
<li><strong>VMware Cloud Provider Lifecycle Manager</strong></li>
<li><a href=/docs/cloud-director/><strong>VMware Cloud Director</strong></a>
<ul>
<li>Automation</li>
<li>Branding & Themes</li>
<li>Extensibility</li>
<li><a href=/docs/cloud-director/identity-access/>Identity & Access</a></li>
<li>Multi-site</li>
<li>Networking</li>
<li>Scale</li>
<li>Security</li>
</ul>
</li>
<li><strong>VMware Cloud Director service</strong>
<ul>
<li><a href=/docs/cloud-director-service/implementation/>Implementation</a></li>
</ul>
</li>
<li><strong>VMware Cloud Director Availability</strong></li>
<li><strong>VMware vCloud Usage Meter</strong></li>
<li><strong>VMware Cloud Director Container Service Extension</strong></li>
<li><strong>VMware Cloud Director Oject Storage Extension</strong></li>
<li><strong>VMware Cloud Director Application Launchpad</strong>
<br></li>
</ul>
<ul>
<li>
<a href=https://cloudsolutions.vmware.com target=_blank rel=noopener>
VMware Cloud Solutions
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Cloud Infrastructure Networking and Security Implementation</strong>
<label for=toc-control>
</label>
</div>
</header>
<article class=markdown><h1 id=procedure>
Procedure
<a class=anchor href=#procedure>#</a>
</h1>
<ul>
<li><a href=#Register-NSX-Manager-Instance-with-VMware-Cloud-Director>Register NSX Manager Instance with VMware Cloud Director</a></li>
</ul>
<h2 id=register-nsx-manager-instance-with-vmware-cloud-director>
Register NSX Manager Instance with VMware Cloud Director
<a class=anchor href=#register-nsx-manager-instance-with-vmware-cloud-director>#</a>
</h2>
<p>VMware NSX can provide network resources to VMware Cloud Director (VCD) by registering the NSX Manager in VCD Infrastructure Resource.</p>
<h2 id=prerequisites>
Prerequisites
<a class=anchor href=#prerequisites>#</a>
</h2>
<ul>
<li>Verify the VMware Cloud Director system requirements and supported versions of VMware NSX, <a href=https://interopmatrix.vmware.com/Interoperability>VMware Product Interoperability Matrixes </a></li>
</ul>
<h2 id=procedure-1>
Procedure
<a class=anchor href=#procedure-1>#</a>
</h2>
<ol>
<li>From the top navigation bar, under <strong>Resources</strong>, click <strong>Infrastructure Resources</strong>.</li>
<li>In the left pane, click <strong>NSX-T Managers</strong> and click <strong>Add</strong>.</li>
<li>If you have a multisite VMware Cloud Director deployment, from the <strong>Site</strong> drop-don menu, select the site to which you want to add this NSX Manager instance.</li>
<li>Enter a name and, optionally, a description for the NSX Manager instance in VMware Cloud Director.</li>
<li>Enter the URL of the NSX Manager instance. For example, <em><strong>https://FQDN_or_IP_address</strong></em>.</li>
<li>Enter the network provider scope.</li>
<li>If you are registering Global NSX Manager, select <strong>Global Manager</strong>. In the case of NSX Federated deploymentFor global NSX Manager instances, the scope is automatically set to <strong>Global</strong>.</li>
<li>Enter the user name and password of the NSX Manager <strong>administrator</strong> account and <strong>Save</strong>.</li>
</ol>
<blockquote>
<p>If the endpoint does not have a trusted certificate, on the <strong>Trust Certificate</strong> window confirm if you trust the endpoint. To add the endpoint to the centralized certificate storage area and continue, click <strong>Trust</strong>.</p>
</blockquote>
<h2 id=nsx-api-rate-limits-in-vmware-cloud-director>
NSX API Rate Limits in VMware Cloud Director
<a class=anchor href=#nsx-api-rate-limits-in-vmware-cloud-director>#</a>
</h2>
<p>When you use the NSX API to manage the networking resources of VMware Cloud Director, there are some limitations to consider. The NSX API service has three settings that control the rate of incoming API requests. While it is possible to configure these rate limits using the <code>/api/v1/node/services/http</code> API, it is not recommended. Instead, design your API client to deal with situations where limits are exceeded gracefully.</p>
<table>
<thead>
<tr>
<th>Limit Type</th>
<th>Description</th>
<th>Default Limit</th>
</tr>
</thead>
<tbody>
<tr>
<td>Per-client rate limit</td>
<td>If a client makes more requests than this limit in one second, the API server refuses to service the request and returns an <code>HTTP 429 Too Many Requests</code> Error</td>
<td>100 requests per second</td>
</tr>
<tr>
<td>Per-client concurrency limit</td>
<td>This is the maximum number of outstanding requests that a client can have. For example, a client can open multiple connections to NSX and submit operations on each connection. When this limit is exceeded, the server returns a <code>429 Too Many Requests</code> error to the client</td>
<td>40 concurrent requests</td>
</tr>
<tr>
<td>An overall maximum number of concurrent requests</td>
<td>This is the maximum number of API requests that can be in process on the server. If the server is at this limit, additional requests are refused and the HTTP error <code>503 Service Unavailable</code> returns to the client</td>
<td>199 concurrent requests</td>
</tr>
</tbody>
</table>
<h1 id=create-segment-profile-templates-optional>
Create Segment Profile Templates (Optional)
<a class=anchor href=#create-segment-profile-templates-optional>#</a>
</h1>
<p>A segment profile template is a set of NSX segment profiles created in NSX Manager and used by the VMware Cloud Director. In VMware Cloud Director, segment profile templates can be applied to organization VDC networks and vApp networks upon their creation or as an update. Depending on the environment&rsquo;s needs, segment profile templates are applied at different levels.</p>
<p>Global segment profile template can be applied to all new organization VDC networks or vApp networks within a specific site. Segment profile templates can be set per organization VDC network and vApp network at the organization VDC level. These VDC segment profile templates would override any global default segment profile templates. A specific segment profile template can be applied when a new organization VDC network is created or updated.</p>
<h2 id=prerequisites-1>
Prerequisites
<a class=anchor href=#prerequisites-1>#</a>
</h2>
<p>Verify that you have created segment profiles in NSX Manager.</p>
<h2 id=procedure-2>
Procedure
<a class=anchor href=#procedure-2>#</a>
</h2>
<ol>
<li>From the top navigation bar, under <strong>Resources</strong>, click <strong>Infrastructure Resources</strong>.</li>
<li>Under <strong>NSX-T</strong>, click <strong>Segment Profile Templates</strong>.</li>
<li>Select the <strong>Templates</strong> tab.</li>
<li>If you are managing a multisite environment, from the drop-down menu, select a site in which to create the new segment profile template.</li>
<li>Enter a name and, optionally, a description, for the new template.</li>
<li>From the list, select the NSX Manager instance with the segment profiles that you want to use as a source for this template.</li>
<li>Select a segment profile from each type to add to the template.</li>
<li>If you don&rsquo;t select a segment profile for a given type, the NSX Manager default is included in the template.</li>
<li>Review the <strong>Ready to Complete</strong> page, and click <strong>Finish</strong>.</li>
</ol>
<h1 id=configure-segment-profiles-templates-global-default-optional>
Configure Segment Profiles Templates Global Default (Optional)
<a class=anchor href=#configure-segment-profiles-templates-global-default-optional>#</a>
</h1>
<p>You can set global default segment profiles to be applied to all VDC networks and all vApp networks in a VMware Cloud Director environment upon their creation. The global default segment profile templates apply to a network if you don&rsquo;t configure custom segment profiles at the time of the network creation and if you haven&rsquo;t set a default segment profile template for the organization VDC in which you are creating the network.</p>
<h2 id=prerequisites-2>
Prerequisites
<a class=anchor href=#prerequisites-2>#</a>
</h2>
<p>Verify that you created segment profile template in VMware CLoud Director.</p>
<h2 id=procedure-3>
Procedure
<a class=anchor href=#procedure-3>#</a>
</h2>
<ol>
<li>From the top navigation bar, under <strong>Resources</strong>, click <strong>Infrastructure Resources</strong>.</li>
<li>Under <strong>NSX-T</strong>, click <strong>Segment Profile Templates</strong>.</li>
<li>Click the <strong>Global Default</strong> tab.</li>
<li>If you are managing a multisite environment, select the site for which you want to set a global template.</li>
<li>Click <strong>Edit</strong>.</li>
<li>To set a default template for VDC networks, select a template from the drop-down menu.</li>
<li>To set a default template for vApp networks, select a template from the drop-down menu.</li>
<li>Click <strong>Save</strong>.</li>
</ol>
<h1 id=configure-ip-spaces>
Configure IP Spaces
<a class=anchor href=#configure-ip-spaces>#</a>
</h1>
<p>IP Spaces provides a structured approach to allocating public and private IP addresses by preventing overlapping IP addresses across Organizations and organization VDCs in VMware Cloud Director. An IP space consists of a set of defined non-overlapping IP ranges and small CIDR blocks that are reserved and used during the consumption aspect of the IP space life cycle. An IP space can be either IPv4 or IPv6, but not both. A service provider, can create public, shared, or private IP spaces and assign them to provider gateways by creating IP space uplinks. There are three types of IP Spaces the can be created in VCD.</p>
<table>
<thead>
<tr>
<th>IP Spaces Types</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Public IP Space</td>
<td>A public IP space is used by multiple organizations and is controlled by the service provider through a quota-based system.</td>
</tr>
<tr>
<td>Shared IP Space</td>
<td>An IP space for services and management networks that are required in the tenant space, but as a service provider, you don&rsquo;t want to expose it to organizations in your environment.</td>
</tr>
<tr>
<td>Private IP Space</td>
<td>Private IP spaces are dedicated to a single tenant - a private IP space is used by only one organization that is specified during the space creation. For this organization, IP consumption is unlimited.</td>
</tr>
</tbody>
</table>
<h2 id=prerequisites-3>
Prerequisites
<a class=anchor href=#prerequisites-3>#</a>
</h2>
<p>To create Public or Shared IP Space verify that your role includes the <strong>System IP Spaces:View</strong> and <strong>System IP Spaces:Manage</strong> rights.</p>
<h2 id=procedure-4>
Procedure
<a class=anchor href=#procedure-4>#</a>
</h2>
<ol>
<li>From the top navigation bar, select <strong>Resources</strong> and click <strong>Cloud Resources</strong>.</li>
<li>In the left pane, select <strong>IP Spaces</strong></li>
<li>If you are using a multisite deployment, select a site where to create the IP space from the drop-down list.</li>
<li>Select the IP Space type. In the case of Private IP Space, also select organization.</li>
<li>Enter a name and, optionally, a description for the new IP space.</li>
<li>(Optional) On the Network Topology page, you can configure IP Space features to help enable north-south traffic.</li>
<li>To define the IP space scope, enter up to five IP ranges and prefixes.</li>
</ol>
<ul>
<li>The internal scope of an IP space is a list of CIDR notations that defines the exact span of IP adresses in which all ranges and blocks must be contained in. The internal scope of the IP space is used to define default NAT rules and BGP prefixes.</li>
<li>You can use either IPv4 or IPv6.</li>
</ul>
<ol start=7>
<li>(Optional) Enter a CIDR notation for the external scope for the IP space.</li>
</ol>
<ul>
<li>The external scope defines the total span of IP addresses to which the IP space has access, for example the internet or a WAN. The external scope of the IP space is used to define default NAT rules and BGP prefixes.</li>
</ul>
<ol start=8>
<li>(Optional) Enter IP ranges for the IP space.</li>
<li>(Optional) Enter IP prefixes for the IP space.</li>
<li>If you entered at least one floating IP address in the IP Ranges page, enter a number of floating IP addresses to allocate individually or select the <strong>Unlimited</strong> checkbox.</li>
<li>If you entered at least one IP prefix in the IP Prefixes page, enter a number of IP prefixes, or select the Unlimited checkbox.</li>
<li>Review the Ready to Complete page, and click <strong>Finish</strong>.</li>
</ol>
<h2 id=terraform-procedure>
Terraform Procedure
<a class=anchor href=#terraform-procedure>#</a>
</h2>
<ol>
<li>Configure Terraform resource, using the example below. The <code>type</code> can be <code>PUBLIC</code>, <code>SHARED_SERVICES</code>, or <code>PRIVATE</code>. In the case of Private IP Spaces, the organization ID must also be specified using the argument: <code>org_id = data.vcd_org.org1.id</code></li>
</ol>
<pre tabindex=0><code>resource &quot;vcd_ip_space&quot; &quot;space1&quot; {
  name = &quot;Public-Tokyo&quot;
  type = &quot;PUBLIC&quot;
  internal_scope = [&quot;192.168.1.0/24&quot;, &quot;10.10.10.0/24&quot;, &quot;11.11.11.0/24&quot;]
  route_advertisement_enabled = true
  ip_prefix {
    default_quota = 2
    prefix {
      first_ip      = &quot;192.168.1.100&quot;
      prefix_length = 30
      prefix_count  = 4
    }
  }
  ip_prefix {
    default_quota = -1
    prefix {
      first_ip      = &quot;10.10.10.96&quot;
      prefix_length = 29
      prefix_count  = 4
    }
  }
  ip_range {
    start_address = &quot;11.11.11.100&quot;
    end_address   = &quot;11.11.11.110&quot;
  }
}
</code></pre><ol start=2>
<li>Initialize the current directory and the required Terraform providers.</li>
</ol>
<pre tabindex=0><code>terrafrom init
</code></pre><ol start=3>
<li>Create a Terraform plan and save the output to a file.</li>
</ol>
<pre tabindex=0><code>terrafrom plan -out=tfplan
</code></pre><ol start=4>
<li>Apply the Terraform plan.</li>
</ol>
<pre tabindex=0><code>terraform apply tfplan
</code></pre><h1 id=configure-provider-gateways>
Configure Provider Gateways
<a class=anchor href=#configure-provider-gateways>#</a>
</h1>
<h1 id=configure-external-networks>
Configure External Networks
<a class=anchor href=#configure-external-networks>#</a>
</h1>
<h1 id=configure-network-pools>
Configure Network Pools
<a class=anchor href=#configure-network-pools>#</a>
</h1>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
</main>
</body>
</html>