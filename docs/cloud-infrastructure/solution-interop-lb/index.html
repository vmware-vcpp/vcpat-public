<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Advanced Load Balancing for Cloud Infrastructure #  After you implement the Cloud Infrastructure validated solution, you can enable load balancing services for VMware Cloud Director tenants by integrating it with the Advanced Load Balancing services for the VI Workload Domain in your VMware Cloud Foundation environment.
For validated load balancing solutions, see Advanced Load Balancing Validated Solutions.[link]
Integration with NSX Advanced Load Balancer #  If your environment is running NSX Advanced Load Balancer, you can connect VMware Cloud Director to the Advanced Load Balancing service.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Advanced Load Balancing for Cloud Infrastructure">
<meta property="og:description" content="Advanced Load Balancing for Cloud Infrastructure #  After you implement the Cloud Infrastructure validated solution, you can enable load balancing services for VMware Cloud Director tenants by integrating it with the Advanced Load Balancing services for the VI Workload Domain in your VMware Cloud Foundation environment.
For validated load balancing solutions, see Advanced Load Balancing Validated Solutions.[link]
Integration with NSX Advanced Load Balancer #  If your environment is running NSX Advanced Load Balancer, you can connect VMware Cloud Director to the Advanced Load Balancing service.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://vcpat.cloudhappens.io/docs/cloud-infrastructure/solution-interop-lb/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2023-10-23T11:24:41+03:00">
<title>Advanced Load Balancing for Cloud Infrastructure | VMware Cloud Provider Architecture Toolkit</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.6e661d8c30043acad0570d2aac894058c2869246edc9f398c372fe57f9414c88.js integrity="sha256-bmYdjDAEOsrQVw0qrIlAWMKGkkbtyfOYw3L+V/lBTIg=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><span>VMware Cloud Provider Architecture Toolkit</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li><a href=/feedback/><em>Feedback</em></a></li>
</ul>
<h2 id=draft-validated-solutions>
Draft Validated Solutions:
<a class=anchor href=#draft-validated-solutions>#</a>
</h2>
<ul>
<li><a href=/docs/cloud-infrastructure/><strong>Cloud Infrastructure</strong></a>
<ul>
<li><a href=/docs/cloud-infrastructure/planning/>Planning and Preparation</a></li>
<li><a href=/docs/cloud-infrastructure/design/>Design Objectives</a></li>
<li><a href=/docs/cloud-infrastructure/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/cloud-infrastructure/implementation/>Implementation</a></li>
<li><a href=/docs/cloud-infrastructure/operations/>Operational Guidance</a></li>
<li><a href=/docs/cloud-infrastructure/design-decisions/>Design Decisions</a></li>
<li><a href=/docs/cloud-infrastructure/solution-interop/>Solution Interoperability</a></li>
<li><a href=/docs/cloud-infrastructure/appendix/>Appendix</a></li>
</ul>
</li>
<li><a href=/docs/dr-migration/><strong>DR and Migration</strong></a>
<ul>
<li><a href=/docs/dr-migration/planning/>Planning and Preparation</a></li>
<li><a href=/docs/dr-migration/design/>Design Objectives</a></li>
<li><a href=/docs/dr-migration/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/dr-migration/implementation/>Implementation</a></li>
<li><a href=/docs/dr-migration/operations/>Operational Guidance</a></li>
</ul>
</li>
<li><a href=/docs/developer-ready-cloud/><strong>Developer Ready Cloud</strong></a>
<ul>
<li><a href=/docs/developer-ready-cloud/planning/>Planning and Preparation</a></li>
<li><a href=/docs/developer-ready-cloud/design/>Design Objectives</a></li>
<li><a href=/docs/developer-ready-cloud/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/developer-ready-cloud/implementation/>Implementation</a></li>
<li><a href=/docs/developer-ready-cloud/operations/>Operational Guidance</a></li>
</ul>
</li>
<li><a href=/docs/sovereign-cloud/><strong>Sovereign Cloud</strong></a>
<ul>
<li><a href=/docs/sovereign-cloud/planning/>Planning and Preparation</a></li>
<li><a href=/docs/sovereign-cloud/design/>Design Objectives</a></li>
<li><a href=/docs/sovereign-cloud/detailed-design/>Detailed Design</a></li>
<li><a href=/docs/sovereign-cloud/implementation/>Implementation</a></li>
<li><a href=/docs/sovereign-cloud/operations/>Operational Guidance</a></li>
</ul>
</li>
</ul>
<h2 id=toolkit-documents>
Toolkit Documents:
<a class=anchor href=#toolkit-documents>#</a>
</h2>
<ul>
<li><strong>VMware Cloud Provider Lifecycle Manager</strong></li>
<li><a href=/docs/cloud-director/><strong>VMware Cloud Director</strong></a>
<ul>
<li>Automation</li>
<li>Branding & Themes</li>
<li>Extensibility</li>
<li><a href=/docs/cloud-director/identity-access/>Identity & Access</a></li>
<li>Multi-site</li>
<li>Networking</li>
<li>Scale</li>
<li>Security</li>
</ul>
</li>
<li><strong>VMware Cloud Director service</strong>
<ul>
<li><a href=/docs/cloud-director-service/implementation/>Implementation</a></li>
</ul>
</li>
<li><strong>VMware Cloud Director Availability</strong></li>
<li><strong>VMware vCloud Usage Meter</strong></li>
<li><strong>VMware Cloud Director Container Service Extension</strong></li>
<li><strong>VMware Cloud Director Oject Storage Extension</strong></li>
<li><strong>VMware Cloud Director Application Launchpad</strong>
<br></li>
</ul>
<ul>
<li>
<a href=https://cloudsolutions.vmware.com target=_blank rel=noopener>
VMware Cloud Solutions
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Advanced Load Balancing for Cloud Infrastructure</strong>
<label for=toc-control>
</label>
</div>
</header>
<article class=markdown><h1 id=advanced-load-balancing-for-cloud-infrastructure>
Advanced Load Balancing for Cloud Infrastructure
<a class=anchor href=#advanced-load-balancing-for-cloud-infrastructure>#</a>
</h1>
<p>After you implement the Cloud Infrastructure validated solution, you can enable load balancing services for VMware Cloud Director tenants by integrating it with the Advanced Load Balancing services for the VI Workload Domain in your VMware Cloud Foundation environment.</p>
<p>For validated load balancing solutions, see Advanced Load Balancing Validated Solutions.[link]</p>
<h1 id=integration-with-nsx-advanced-load-balancer>
Integration with NSX Advanced Load Balancer
<a class=anchor href=#integration-with-nsx-advanced-load-balancer>#</a>
</h1>
<p>If your environment is running NSX Advanced Load Balancer, you can connect VMware Cloud Director to the Advanced Load Balancing service.</p>
<p>Design Decisions for Advanced Load Balancing as a service for Cloud Infrastructure</p>
<table>
<thead>
<tr>
<th>Decision ID</th>
<th>Design Decision</th>
<th>Design Justification</th>
<th>Design Implications</th>
</tr>
</thead>
<tbody>
<tr>
<td>VVS-COMP1-001</td>
<td>Decision comment</td>
<td>Justification comments</td>
<td>Implication comments</td>
</tr>
<tr>
<td>VVS-COMP1-002</td>
<td>Decision comment</td>
<td>Justification comments</td>
<td>Implication comments</td>
</tr>
<tr>
<td>VVS-COMP1-002</td>
<td>Decision comment</td>
<td>Justification comments</td>
<td>Implication comments</td>
</tr>
</tbody>
</table>
<h1 id=planning-and-preparation-for-load-balancing-as-a-service-in-vmware-cloud-director>
Planning and Preparation for Load Balancing as a Service in VMware Cloud Director
<a class=anchor href=#planning-and-preparation-for-load-balancing-as-a-service-in-vmware-cloud-director>#</a>
</h1>
<h2 id=introduction>
Introduction
<a class=anchor href=#introduction>#</a>
</h2>
<p>Before you start implementing the <strong>Load Balancing as a Service in VMware Cloud Director</strong> solution, you must set up an environment that has a specific compute, storage, and network configuration and that provides external services to the components of the solution.</p>
<h2 id=requirements>
Requirements
<a class=anchor href=#requirements>#</a>
</h2>
<h3 id=software>
Software
<a class=anchor href=#software>#</a>
</h3>
<p>To implement load balancing as a service with VMware Cloud Director, your software versions must meet the requirements specified in the <a href=https://interopmatrix.vmware.com/Interoperability>VMware Product Interoperability Matrix</a>.</p>
<h3 id=resources>
Resources
<a class=anchor href=#resources>#</a>
</h3>
<p>Before you deploy NSX Advanced Load Balancer, you must provide sufficient compute and storage resources to meet the footprint requirements of the Controller cluster and the Service Engines.</p>
<ul>
<li><a href=https://avinetworks.com/docs/21.1/avi-controller-sizing/>Avi Controller Sizing</a></li>
<li><a href=https://avinetworks.com/docs/21.1/sizing-service-engines/>Sizing Service Engines</a></li>
</ul>
<h3 id=networking>
Networking
<a class=anchor href=#networking>#</a>
</h3>
<p>This load balancing as a service solution is based on several management virtual appliances that require to be deployed in a management infrastructure. <strong>Latency requirements</strong> are critical to guarantee proper functioning and performance:</p>
<ul>
<li>Latency among Avi controllers – Less than 10 ms</li>
<li>Latency between any Avi SE to any Avi Controller – Less than 75 ms recommended</li>
<li>Latency between Avi Controller and NSX-T Manager – Less than 10 ms recommended
<ul>
<li>Best practice is to co-locate in the same port group/management infrastructure as NSX-T</li>
</ul>
</li>
<li>Latency between Avi Controller and VMware Cloud Director – Best practice is to have have VCD cells in the same management infrastructure as NSX-T manager and Avi Controller</li>
</ul>
<p>The Avi Controller and service engines use several ports for management and control communication: <a href=https://avinetworks.com/docs/21.1/protocol-ports-used-by-avi-vantage-for-management-communication/>Protocol Ports Used by Avi Vantage for Management Communication</a>.</p>
<p>The firewall should allow traffic for these ports.</p>
<h2 id=preparation>
Preparation
<a class=anchor href=#preparation>#</a>
</h2>
<p>The solution comprises of the Avi Controller which uses APIs to interface with the NSX-T manager and vCenter to discover the infrastructure. It also manages the lifecycle and network configuration of the service engines.</p>
<p>The <strong>NSX-T Cloud</strong> is the object that permits the integration with the NSX-T manager and the vCenter server(s).</p>
<p>The user accounts configured on the Avi Controller require the following roles and permissions for the integration to work successfully:</p>
<ul>
<li><a href=https://avinetworks.com/docs/21.1/roles-and-permissions-for-vcenter-nsx-t-users/#vcenter-roles>Roles and Permissions for vCenter user</a></li>
<li><a href=https://avinetworks.com/docs/21.1/roles-and-permissions-for-vcenter-nsx-t-users/#nsx-t-roles>Roles and Permissions for NSX-T user</a></li>
</ul>
<h3 id=vsphere>
vSphere
<a class=anchor href=#vsphere>#</a>
</h3>
<p>When using an NSX-T Cloud, the Avi Controller uploads the service engine image to the <strong>content library</strong> on the vCenter server and uses this to create new virtual machine every time a new service engine is required. The content library must be <a href=https://avinetworks.com/docs/21.1/avi-nsx-t-integration/#content-library>created on vCenter before configuring the NSX-T cloud</a>.</p>
<h3 id=nsx-t>
NSX-T
<a class=anchor href=#nsx-t>#</a>
</h3>
<p>The first network adapter of the service engine VM is reserved for management connectivity, and the remaining 9 data interfaces (network adapter 2 to 10) for the service engine VM to the VIP or data segment.</p>
<p>The Avi SE management interface can be connected to an overlay (recommend) or a VLAN logical segment. When connected to an overlay segment, it also needs a tier-1 gateway to provide external connectivity to be able to reach the Avi controller management IP. It is recommended to have a dedicated tier-1 gateway and segment for Avi service engine management.</p>
<blockquote class="book-hint info">
If VLAN-backed logical segments are used instead of overlay transport zone for the management network in the NSX-T Cloud, refer to this page: <a href=https://avinetworks.com/docs/21.1/nsx-t-vlan-logical-segment/>NSX-T VLAN Logical Segment</a>.
</blockquote>
<p>Regardless of the solution (overlay or VLAN segment for the SE management network), the NSX-T topology must be created upfront the NSX-T Cloud configuration. In the case of overlay segment for the SE management network:</p>
<ol>
<li>Create a tier-1 gateway that will be used to connect the SE management network.</li>
<li>Create 2 overlay segments: one for the management network, and one as a dummy data network segment.</li>
<li>Enable DHCP Server at the tier-1 gateway level and configure DHCP on the management segment.</li>
</ol>
<p>More details here: <a href=https://avinetworks.com/docs/21.1/avi-nsx-t-integration/#configuring-management-networking-for-se>Configuring Management Networking for SE</a>.</p>
<h3 id=vmware-cloud-director-support>
VMware Cloud Director Support
<a class=anchor href=#vmware-cloud-director-support>#</a>
</h3>
<p>Starting with version 10.2, VMware Cloud Director provides load-balancing services by using the capabilities of VMware NSX Advanced Load Balancer (Avi). VMware Cloud Director supports L4 and L7 load balancing that you can configure on an NSX-T Data Center edge gateway.</p>
<p>As a system administrator, you deploy the NSX Advanced Load Balancer controller cluster with the other management solutions in the management infrastructure.</p>
<p><img src=/images/lbaas/lbaas-vcd-architecture.png alt="Load Balancing as a Service in VMware Cloud Director"></p>
<p>The NSX Advanced Load Balancer Controller uses APIs to interface with NSX Manager and vCenter Server to discover the infrastructure. It also manages the lifecycle and network configuration of Service Engines (SE). The Avi Controller cluster uploads the SE OVA image to the vCenter Server content library and uses vCenter APIs to deploy the SE VMs.</p>
<p>This integration happens through an NSX-T Cloud configured in NSX ALB before being imported into VMware Cloud Director.</p>
<p>Load balancing services are associated with NSX-T edge gateways, which can be scoped to an organization VDC or a data center Group.</p>
<p><img src=/images/lbaas/lbaas-vcd-logical-diagram.png alt="Load Balancing as a Service in VMware Cloud Director - Logical Design"></p>
<p>The system administrator has the flexibility to decide whether a service engine group is dedicated to a single edge gateway or shared between several edge gateways.</p>
<p>Tenant users have full self-service UI and API load balancing capabilities in VMware Cloud Director.</p>
<p><img src=/images/lbaas/lbaas-vcd-topology-diagram.png alt="Load Balancing as a Service in VMware Cloud Director - Topology"></p>
<p>A service engine node is a VM with up to 10 network interfaces (NICs). The first NIC is always used for the management and control traffic. The other nine are used to connect to the NSX-T edge gateway (tier-1 gateway) using a service network logical segment. The service networks are created by VMware Cloud Director when you enable the load balancing service on an edge gateway with the DHCP service to provide IP addresses for the attached SEs.</p>
<p>By default, the IP address used is 10.255.255.0/25 subnet. The system administrator can change the IP address if it coincides with the existing organization&rsquo;s VDC networks.</p>
<p>Service Engines run each service interface in a different VRF. As a result, IP conflicts or cross-tenant communication does not occur. Avi automatically picks a service engine to instantiate the load balancing service when the tenant configures a load balancing pool and virtual service.</p>
<p>When an SE is assigned, Avi configures a static route (/32) on the organization VDC edge gateway pointing the virtual service VIP (virtual IP) to the service engine IP address from the tenant&rsquo;s load balancing service network.</p>
<h3 id=provider-and-tenant-responsibilities>
Provider and Tenant Responsibilities
<a class=anchor href=#provider-and-tenant-responsibilities>#</a>
</h3>
<p>As a <strong>system administrator</strong>, you deploy an Avi Controller Cluster, complete the initial configuration and the association with NSX-T and VMware Cloud Director. Once the integration is ready, you deploy and enable load balancing on an NSX-T edge gateway and assign it a service engine group.</p>
<p>An <strong>organization administrator</strong> creates load balancer server pools and virtual services.</p>
<h2 id=deployment--configuration>
Deployment & Configuration
<a class=anchor href=#deployment--configuration>#</a>
</h2>
<p><img src=/images/lbaas/lbaas-vcd-steps.png alt="Load Balancing as a Service in VMware Cloud Director - Implementation Steps"></p>
<h3 id=requirements-1>
Requirements
<a class=anchor href=#requirements-1>#</a>
</h3>
<p>Please find the full list of requirements in the <a href=../vcd-lbaas-planning-and-preparation>planning and preparation page</a>.</p>
<h2 id=proceedure>
Proceedure
<a class=anchor href=#proceedure>#</a>
</h2>
<p><a href=../solution-interop-lb-proceedure.md>Integrate NSX Advanced Load Balancer with VMware Cloud Director</a></p>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
</main>
</body>
</html>